$(function() {

// leanModal v1.1 by Ray Stone - http://finelysliced.com.au
// Dual licensed under the MIT and GPL
$.fn.extend({ 
    leanModal: function(options) {
        var defaults = {
            top: 50,
            overlay: 0.6,
            bg: '#000',
            closeButton: null
        };
        var wrap= $("<div class='wrap'></div>");
        var overlay = $("<div id='lean_overlay'></div>");
        $("body").append(wrap);
        wrap.append(overlay);
        options =  $.extend(defaults, options);
        return this.each(function() {
            var o = options;
            $(this).click(function(e) {
                var modal_id = $(this).attr("href");
                $("body").css('overflow', 'hidden');
                wrap.css("display","block");
                $("#lean_overlay").click(function() { 
                     close_modal(modal_id);
                });

                $(o.closeButton).click(function() { 
                     close_modal(modal_id);
                });
                wrap.append($(modal_id));

                var modal_height = $(modal_id).outerHeight();
                var modal_width = $(modal_id).outerWidth();

                $('#lean_overlay').css({ 'display' : 'block', opacity : 0, background: o.bg });

                $('#lean_overlay').fadeTo(200,o.overlay);

                $(modal_id).css({ 
                    'display' : 'block',
                    'position' : 'absolute',
                    'opacity' : 0,
                    'z-index': 11000,
                    'left' : 50 + '%',
                    'margin-left' : -(modal_width/2) + "px",
                    'top' : o.top + "px"
                });
$('#lean_overlay').height(wrap.height());
                $(modal_id).fadeTo(200,1); overlay.css("height",wrap[0].scrollHeight);
                e.preventDefault(); 
            });
        });

        function close_modal(modal_id){
            wrap.fadeOut(200,function(){
                wrap.css("display","none");
                $(modal_id).css({ 'display' : 'none' });
                $("body").css('overflow', 'auto');
            });

        }
    }
        })
});
